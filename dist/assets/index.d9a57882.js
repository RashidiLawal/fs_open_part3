import{j as y,a as g,r as f,R as L}from"./vendor.9ac37773.js";const O=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))d(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const m of r.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&d(m)}).observe(document,{childList:!0,subtree:!0});function s(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerpolicy&&(r.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?r.credentials="include":n.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function d(n){if(n.ep)return;n.ep=!0;const r=s(n);fetch(n.href,r)}};O();const o=y.exports.jsx,c=y.exports.jsxs,j=y.exports.Fragment,k=({setQuery:e,query:t})=>c("div",{children:["filter shown with ",o("input",{type:"search",placeholder:"Search",value:t,onChange:s=>e(s.target.value)})]}),E=({onSubmit:e,setNewName:t,newName:s,setNewNumber:d,newNumber:n})=>o("div",{children:c("form",{onSubmit:e,children:[c("div",{children:["name: ",o("input",{value:s,onChange:r=>t(r.target.value)})]}),c("div",{children:["number: ",o("input",{value:n,onChange:r=>d(r.target.value)})]}),o("div",{children:o("button",{type:"submit",children:"add"})})]})}),F=({name:e,number:t})=>c("div",{children:[o("span",{children:e}),o("span",{children:t})]}),b="/api/persons",M=()=>g.get(b).then(e=>e.data),T=e=>g.delete(`${b}/${e}`).then(t=>t.data),q=(e,t)=>g.put(`${b}/${e}`,t),D=e=>g.post(b,e).then(s=>s.data);var p={create:D,deletePerson:T,getAll:M,update:q};const R=({message:e,errorMessage:t})=>e===null?null:c("div",{className:"top",children:[e,t]});function B(){const[e,t]=f.exports.useState([]),[s,d]=f.exports.useState(""),[n,r]=f.exports.useState(""),[m,S]=f.exports.useState(""),[w,u]=f.exports.useState(""),[x,N]=f.exports.useState(""),$=i=>{i.preventDefault();const h=e.find(l=>JSON.stringify(l.name)===JSON.stringify(s));if(e.find(l=>l.number===l.newNumber),h){if(window.confirm(`${s} is already added to phonebook. replace the old number with a new one?`)){const l=h.id;p.update(l,{name:s,number:n}).then(a=>{t(C=>C.map(v=>(v.id===a.data.id&&(v.number=a.data.number),v))),r(""),d(""),u(`Added ${s}`),setTimeout(()=>{u(null)},7e3)})}}else{const l={name:s,number:n};p.create(l).then(a=>{t(e.concat(a)),r(""),d(""),u(`Added ${s}`),setTimeout(()=>{u(null)},7e3)}).catch(a=>{u(`An error occured creating ${s}`),setTimeout(()=>{u(null)},7e3)}),p.getAll().then(a=>{t(a)})}},A=m.trim()?e.filter(i=>i.name.toLowerCase().includes(m.trim().toLowerCase())):e;f.exports.useEffect(()=>{console.log("effect"),p.getAll().then(i=>{console.log("promise fulfilled"),console.log(i),t(i)})},[]);const P=i=>{window.confirm("Are you sure you want to delete this person?")&&p.deletePerson(i).then(h=>{t(e.filter(a=>a.id!==i));const l=e.find(a=>a.id===i);u(`${l.name} successfully deleted from phonebook`),setTimeout(()=>{u(null)},2e3)}).catch(h=>{h.response.status===404&&(N(`${e.find(l=>l.id===i).name} has already been removed from server`),setTimeout(()=>{N(null)},2e3))})};return c("div",{children:[o("h2",{children:"Phonebook"}),(w||x)&&o(R,{message:w,errorMessage:x}),o(k,{query:m,setQuery:S}),o("h2",{children:"Add a new"}),o(E,{newName:s,newNumber:n,onSubmit:$,setNewName:d,setNewNumber:r}),o("h2",{children:"Numbers"}),o("div",{children:o(F,{name:A.map((i,h)=>c("div",{children:[c(j,{children:[c("span",{children:[" ",i.name]})," ",o("span",{children:i.number})]}),o("button",{type:"button",onClick:()=>P(i.id),children:"Delete"})]},`person_${h}`))})})]})}L.render(o(B,{}),document.getElementById("root"));
